<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="My ecommerce store for party and celebration supplies, invitations, silverware, cups, plates, matches, wellness items, gifts, bags, and more!" />

  <title>My Store</title>
  <meta property="og:title" content="My Store" />

  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://spenceware-engineer.github.io/FED_Programming_Challenge/" />
  <meta property="og:image"
    content="https://media.istockphoto.com/id/1428709516/photo/shopping-online-woman-hand-online-shopping-on-laptop-computer-with-virtual-graphic-icon.jpg?s=612x612&w=0&k=20&c=ROAncmFL4lbSQdU4VOhyXu-43ngzfEqHE5ZZAw5FtYk=" />

  <style>
    html,
    body {
      max-width: 100vw;
      overflow-x: hidden;
      margin: 0;
      padding: 0;
    }

    * {
      box-sizing: border-box;
      font-family: Arial, Helvetica, sans-serif;
    }

    #plist {
      background-color: #D7CDCC;
      width: 100%;
      padding: 10px;
    }

    .plist__product {
      background-color: #22162B;
      border-radius: 20px;
      display: inline-block;
      margin: 10px;
      min-width: 15%;
      padding: 15px;
    }

    .product__favorite {
      height: 52px;
      width: 52px;
      padding: 10px 10px 10px 0px;
      vertical-align: middle;
    }

    .product__favorite--hover {
      height: 52px;
      width: 52px;
      padding: 8px 8px 8px 0px;
      vertical-align: middle;
    }

    .product__name {
      color: #D7CDCC;
      display: inline-block;
      margin-right: 10px;
      position: relative;
      vertical-align: middle;
    }

    .product__name--hover {
      color: #D7CDCC;
      display: inline-block;
      margin-right: 10px;
      position: relative;
      vertical-align: middle;
      text-decoration: underline;
    }

    .cat__container {
      background-color: #731DD8;
      color: #D7CDCC;
      padding: 5px 10px;
      border-radius: 999px;
      grid-area: cat;
      display: inline-block;
      margin: 0px 10px 10px 0px;
    }

    .cat__name {
      padding: 0;
      margin: 0;
      display: inline-block;
    }

    .product__price--hidden {
      visibility: hidden;
      width: 120px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px 0;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -60px;
      opacity: 0;
    }

    .product__price--visible {
      visibility: visible;
      width: 120px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px 0;
      position: absolute;
      z-index: 1;
      top: 75%;
      left: 50%;
      margin-left: -60px;
      opacity: 1;
    }

    .price__old {
      color: #928677;
      text-decoration: line-through;
      display: inline-block;
      font-weight: lighter;
    }

    .price__new {
      color: #A2D729;
      display: inline-block;
      font-weight: bold;
      margin: 0;
      padding: 0 5px;
      font-size: 1.25em;
    }
  </style>
</head>

<body>
  <!-- div#plist as the root element and product list container -->
  <div id="plist"></div>
  <script>
    // get the root element (the product list container) to be able to add content to page
    const ROOT_EL = document.getElementById('plist')

    // Create JSON-LD string for product
    const generateJSONLD = (product) => {
      return `{
        "@context": "https://schema.org/",
        "@type": "Product",
        "name": ${product.product},
        "offers": {
          "@type": "Offer",
          "price": ${product.sale},
          "priceCurrency": "USD",
          "priceSpecification": {
            "@type": "UnitPriceSpecification",
            "priceType": "https://schema.org/StrikethroughPrice",
            "price": ${product.price},
            "priceCurrency": "USD"
          }
        }
      }`
    }

    // Add JSON-LD to head
    const addJSONLD = (content) => {
      const script = document.createElement('script')
      script.setAttribute('type', 'application/ld+json')
      script.textContent = content
      document.head.appendChild(script)
    }

    // create product listing
    const productListing = (product) => {
      // create product container and set class for styling
      const productContainer = document.createElement('div')
      productContainer.setAttribute('class', 'plist__product')

      // Container for the heart icon (favorite)
      const productHeading = document.createElement('div')

      let favorited = localStorage.getItem(product.id) === 'true' ? true : false

      // Load heart icon based on whether or not the item is favorited
      const favIcon = document.createElement('img')
      favIcon.setAttribute('class', 'product__favorite')
      favIcon.setAttribute('alt', favorited ? `${product.product} marked as favorite` : `${product.product} not favorited`)
      favIcon.setAttribute('src', `./assets/product__favorited--${favorited}.svg`)
      productHeading.appendChild(favIcon)

      // Container for Product Name with Price display
      const productNameWithPrice = document.createElement('div')
      productNameWithPrice.setAttribute('class', 'product__name')

      // Product Name
      const productName = document.createElement('h2')
      productName.innerHTML = product.product
      productName.setAttribute('aria-described-by', `${product.id}-price`)
      productNameWithPrice.appendChild(productName)
      productHeading.appendChild(productNameWithPrice)

      // Create Price container
      const productPrice = document.createElement('div')
      productPrice.setAttribute('class', 'product__price--hidden')
      productPrice.setAttribute('id', `${product.id}-price`)
      productPrice.setAttribute(
        'aria-label',
        `Regular price $${product.price} on sale for $${product.sale}`
      )
      productPrice.setAttribute('role', 'tooltip')

      // Display the regular price (gray with a strike through)
      const oldPrice = document.createElement('p')
      oldPrice.setAttribute('class', 'price__old')
      oldPrice.innerHTML = `$${product.price.toFixed(2)}`
      productPrice.appendChild(oldPrice)

      // Display the new price (green and bold)
      const newPrice = document.createElement('p')
      newPrice.setAttribute('class', 'price__new')
      newPrice.innerHTML = `$${product.sale.toFixed(2)}`
      productPrice.appendChild(newPrice)

      productNameWithPrice.appendChild(productPrice)

      productNameWithPrice.addEventListener('mouseenter', function (e) {
        productName.setAttribute('class', 'product__name--hover')
        productPrice.setAttribute('class', 'product__price--visible')
      })

      productNameWithPrice.addEventListener('mouseleave', function (e) {
        productName.setAttribute('class', 'product__name')
        productPrice.setAttribute('class', 'product__price--hidden')
      })

      // Container for the categories to be displayed
      const productCatList = document.createElement('div')
      productCatList.setAttribute('class', 'product__cat-list')

      // Add a category tag to the category display for each category
      product.cat.forEach(cat => {
        // Category Tag Pill Container
        const productCat = document.createElement('div')
        productCat.setAttribute('class', 'cat__container')

        // Product Category label
        const productCatName = document.createElement('p')
        productCatName.setAttribute('class', 'cat__name')
        productCatName.innerHTML = cat

        // Add Category name to the Category Container
        productCat.appendChild(productCatName)
        // Add Category to Category List
        productCatList.appendChild(productCat)
      })

      // Put all the parts of the product listing together
      productContainer.appendChild(productHeading)
      productContainer.appendChild(productCatList)
      /* productContainer.appendChild(productPrice) */

      productContainer.addEventListener('mouseenter', function (e) {
        favIcon.setAttribute('class', 'product__favorite--hover')
      })

      productContainer.addEventListener('mouseleave', function (e) {
        favIcon.setAttribute('class', 'product__favorite')
      })

      productContainer.addEventListener('click', function (e) {
        localStorage.setItem(product.id, localStorage.getItem(product.id) === 'true' ? 'false' : 'true')
        favorited = localStorage.getItem(product.id) === 'true' ? true : false
        favIcon.setAttribute('alt', favorited ? `${product.product} marked as favorite` : `${product.product} not favorited`)
        favIcon.setAttribute('src', `./assets/product__favorited--${favorited}.svg`)
      })

      // Return the product listing DOM element
      return productContainer
    }

    fetch('https://raw.githubusercontent.com/neodigm/FED_Programming_Challenge/refs/heads/gh-pages/products.json')
      .then(res => (
        res.json()
      ))
      .then(res => (
        res.map((prod) => {
          const id = [ ...prod.cat.split(', '), prod.product ].join('-').split(' ').join('')
          return ({
            ...prod,
            cat: prod.cat.split(', '),
            id,
            price: Number(prod.price),
            sale: Number(prod.sale),
            fav: localStorage.getItem(id) === 'true' ? true : false,
          })
        })
      ))
      .then(res => {
        let jsonld = ''
        res.forEach(prod => jsonld += generateJSONLD(prod))
        addJSONLD(jsonld)
        res.forEach(prod => ROOT_EL.appendChild(productListing(prod)))
      })
      .catch((err) => {
        console.log(err)
      })
  </script>
</body>

</html>
